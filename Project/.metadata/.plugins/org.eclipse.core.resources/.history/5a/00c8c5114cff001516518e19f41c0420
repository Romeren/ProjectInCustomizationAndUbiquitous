/*
 * generated by Xtext 2.9.2
 */
package org.xtext.sdu.iotvizualizerlanguage.generator

import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import org.xtext.sdu.iotvizualizerlanguage.vizualizer.Page
import javax.inject.Inject
import java.util.List

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class VizualizerGenerator extends AbstractGenerator {

	@Inject Precompile precompile
	@Inject Postcompile postcompile

	override void doGenerate(Resource resource, IFileSystemAccess2 fsa, IGeneratorContext context) {
		precompile.precompile(resource, fsa);
		
		var List<String> pageNames = newArrayList
		
		for(p: resource.allContents.toIterable.filter(Page)) {
			pageNames.add(p.name)
			
			//generate HTML template:
			fsa.generateFile(
				"templates\\" + p.name + ".html",
				p.compileTemplateHTML
			)
			
     		fsa.generateFile(
     			p.name + ".py", 
     			p.compile
     		)
    	}
    	
    	postcompile.postcompile(fsa, pageNames)
	}
	
	
	def compileTemplateHTML(Page p)
	'''
	{% extends 'base.html' %}
	{% block content %}
	<div>
		<c>
		<h1>
			This is Page «p.name»
		</h1>
		</c>
	</div>
	{% endblock %}
	'''
	
	def compile(Page p)
	'''
	print("Hello world")
	'''
	
	
}
