\subsection{Overview}
The DSL is divided into three components, a arithmetic expressions language, a language for specifying a web site and a language for specifying input sources for the system. 
The expression language is a utility language which is included by the two others. 
This language defines how a user can create arithmetic expressions in either of the other two languages. 
The Web visualizer is a language to create dynamic web sites, like the sample page shown on the front page. 
This language lets the user create pages on a site, link different pages to each other and visualize information through the use of graphs. 
The Datasources language, which is still to be developed, will be used to specify different data sources, like for instance a external databases or APIs. 
In addition this language will also be used to specify internal persistence and a API for other systems to use for posting data to the Dashk system.

\subsection{The Formula Expression Language}
The Formula Expressions DSL is responsible for understanding mathematical formulas, which will be applied to tables of data.
\paragraph{Meta model}

The formula metamodel consist of multiple elements for an overview seen in Figure
\ref{fig:formulaModel}. The types include in the elements included in the model are:
\begin{enumerate}
\item Formula: The overall Structure Element
\item Variable: The variable names included in the formula, appears both left and right side of the equation
\item Expression: The right side of the equal sign in a formula. The Expression collects the parts which is connected with plus($+$) and minus($-$). 
\item Factor: A semi-structure of the expression, Factors collects the parts connected with multiplication($\cdot$) and division($/$).
\item Op1: Identifies a addition or substraction operation
\item Op2: Identifies a multiplication or divison a operation
\item Primitiv: Identifies as either a number or a Variable
\end{enumerate}

\begin{figure}
  \begin{center}
    \includegraphics[width=\linewidth]{images/formulaInstance}
  \end{center}
  \caption{Instance of Formula}
  \label{fig:formulaInstance}
\end{figure}

Given the following the example: $$f(x, y) = 5 + x \cdot 3 - y$$
The rules for the grammar is explained as below also referring to
Figure \ref{fig:formulaInstance}:
\\
A Formula Contains a name which is defined as the letter/word in front of the paranthesis
also underlined in the following formula: $\underline{f}(x, y) = 5 + x \cdot 3 - y$.
In Figure \ref{fig:formulaInstance} ``f'' is defined as ``name'' seen as an attribute
for the overall Formula.
It also contains a list of variables, defined within the paranthesis seperated
by ``,'' as underlined: $f\underline{(x, y)} = 5 + x \cdot 3 - y$. The variables is saved
as a list under formula as ``vars'' seen at List of Variables.
Finally the expression of the formula is everything on the right side of the equal-sign(``=''),
here follows the rule that every variable used in the expression has to appear inside
the paranthesis on the left side of the formula as well, as it works as a function,
the expression part underlined: $f(x, y) = \underline{5 + x \cdot 3 - y}$ refered to
as ``exp'' and seen as ``expression1'' in Figure \ref{fig:formulaInstance}. 

Looking at the expression(``expression1''): $5 + x \cdot 3 - y$ it is broken down by continouisly
working from the left to the right. the left part of the expression is defined as a factor until
it meets an addition or substraction sign. For the formula example this would put only the number
``5'' into the left side factor as ``factor1'' in Figure \ref{fig:formulaInstance},
futher containing ``5'' in the Number object ``n1''.
Expression2 is then the rest of the equation after $5 +$. The new expression
contains again one factor which is the left side($x \cdot 3$) seperated by the substraction sign
The factor ``factor2'' contains on the left ``var1'' which is x, and on the right another factor
is spawned seen as ``factor3'' in Figure \ref{fig:formulaInstance}, only containing a left
side being the number seen in ``n2'' as 3.
Coming back up to the expression. it contains the last part of y as ``expression3''
which only a left side being a factor(factor4) and that factor also only contains a left side
which is the variable ``var2'' being the y.

For the variables ``var1'' and ``var2'', both is included in the List of Variables in as seen in
Figure \ref{fig:formulaInstance}


\begin{figure}
  \begin{center}
  \includegraphics[width=\linewidth]{images/MetaFormula}
  \end{center}
  \caption{Model of the formula module}
  \label{fig:formulaModel}
\end{figure}
\paragraph{Language Validation}
has been archieved partly by the BNF(PUT REF TO WHAT BNF IS HERE) using xtext, but also
using xtend to write additional validation code, where the xtext language was not sufficient
to validate that the structure did indeed not violate any rules.

xtext could only validate the general structure of the model.
what xtext was not archieved was to have xtext validate that the only variables used
on the right side og the equation sign was declared on the left side.
In order to validate that the variables on the right was declared on the left a
collection containing the declared variables on the left was matches against all the variables
on the right fetched using recursion with depth first search.

\subsection{The Web visualizer Language}
For generating dashboards custom language have been created.
This language specify:
\begin{itemize}
\item Which pages the web-interface consist of
\item The navigation between pages
\item Which data to display and where
\item Where and how to obtain the data
\subitem Internal data streams
\subitem External data streams
\item How to manipulate the data streams
\end{itemize}
The following subsection will look into detail of how the language is structured and the syntax and grammar of the language.

\subparagraph{The Grammar}

Figure \ref{fig:languagemodel} shows the structure of the language.
This model shows that the language defines of a system containing three parts:
\begin{itemize}
\item Pages
\item Sources
\item Schemas
\end{itemize}
\textbf{The Pages,} is what the language in turns will use to create web pages in a system defined in the language.
A page is a collection of tiles. 
Each tile is an extendible definition of a visual object on a page.
In the current version, there are two types of Tiles, Links and Graphs.
A Link definition contains a pointer to a page. 
A Graph however, has a reference data \textit{source} from witch it needs to fetch data from.
\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/GrammaDefinition}
\end{center}
\caption{Sample grammar definition}
\label{fig:grammadefinition}
\end{figure}
Figure \ref{fig:grammadefinition} shows how this grammar was specified.
\textbf{The Sources, } can be of two different types, an \textit{EndPoint} or a \textit{DataSource}.
An EndPoint is intended to function as interface towards external systems or data sources. 
Whereas a Datasource is an internal definition intended for filtering, data manipulation or data grouping.\\
This Source, Endpoint, Datasource structure have been defined as a compositional pattern, with source as the component, the Endpoint as a leaf and the Datasource as the composite.
This pattern makes the it possible to compose any number of different structures.
\textbf{Schemas}
\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/languagemodel}
\end{center}
\caption{Model of the language}
\label{fig:languagemodel}
\end{figure}



Below table shows the grammar for the web visualizer language to the left and an example of use on the right. 
As seen from the left side the system consist of a number of pages which again consists of a number of tiles. 
One tile can, in current implementation be either a link to another page or a definition of a graph. 
Since the datasource language have not yet been implemented the web visualizer language currently work with a hard-coded testset. 
Further are only one graph type implemented (a line chart), however the system makes use of D3 framework meaning that extending the system with other graph types is a smaller task.

\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/ExampleUsePages}
\end{center}
\caption{Example language use, defining pages}
\label{fig:examplePages}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/ExampleUseDataSources}
\end{center}
\caption{Example language use, defining data sources}
\label{fig:exampleDatasources}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/ExampleUseEndPoint}
\end{center}
\caption{Example language use, defining endpoints}
\label{fig:exampleEndpoints}
\end{figure}

The example on the right site creates a System instance with three pages, each page with a number of Links and Graphs.

\paragraph{Meta model}
Below is the first meta model of the system. 
This model matches the language specification one to one. 
The System once again is a collection of pages, which again consists of a number of tiles which can be of the two previous described types. 

\paragraph{Language Validation}

\paragraph{Code generation}
To create the website the project uses the Django framework. 
This framework uses an MVC architektur which is extended with a template pattern with HTML documents. 
In order to make the output easy readable and customizable for a user, the first meta model needs to be mapped to a second meta model with more explicit information which matches the MVC architecture better.
This second model can be seen in below diagram. 

\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/websitemodel}
\end{center}
\caption{Model of the Website}
\label{fig:websitemodel}
\end{figure}

The first step of mapping the previous model into the second meta model, is to create a system with a configuration. 
Secondly a default controller is added with the default Django Admin configuration pages. 
This controller gets a number of URLs and default views. 
After this a second controller gets added, this controller is used for the pages defined in the language. 
Each page gets transformed into a url entity, view entity, model and a template HTML-file.
The HTML file holds a easy customizable structure of the content added to the page. The view and model will in time be connected to the Data sources from the previous specified language. 
In addition will the view of a page be responsible of rendering the template with context and data from a datasource. 
After this model have been created each entry in the model is looped through and generated into a file.


\begin{figure}
\begin{center}
\includegraphics[width=\linewidth]{images/PackageDiagram}
\end{center}
\caption{Package diagram of generated sources}
\label{fig:packagediagram}
\end{figure}
\subparagraph{Pages}
\subparagraph{Data sources}
\subparagraph{Api}
