{% extends 'base.html' %}
{% block content %}
<div class="tile-area fg-white tile-area-scheme-dark">
	<h1 class="tile-area-title">index</h1>
	<div class="tile-area-controls">
		<a class="image-button bg-lightBlue fg-white bg-hover-dark no-border" href='/pageOne/'>toPageOne</a>
	</div>
	<div class="tile-group">
		<span class="tile-group-title">General</span>
		<div class="tile-container">
			<div class="tile-small bg-lightTeal fg-white" onclick="document.location.href='/pageOne/'">
				<div class="tile-content">
					<span>toPageOne<span>
				</div>
			</div>
			<div class="tile-large bg-indigo fg-white">
				<div class="tile-content chart" id="testGraph" data-graph-content="{{graph_data_testGraph}}" onclick="repainttestGraph()">
				</div>
				<span class="tile-label">testGraph<span>
			</div>
			<script type="text/javascript">
						function painttestGraph(){
						console.log("chart script start");
						var width = $("#testGraph").parent().width();
						var height = $("#testGraph").parent().height();
						var margin = {top: (height/100)*10, right: (width/100)*5, bottom: (height/100)*10, left: (width/100)*15};
			
						width +=- margin.left - margin.right;
						height += - margin.top - margin.bottom;
						
						var x = d3.time.scale()
						    .range([0, width])
						
						var y = d3.scale.linear()
						    .range([height, 0]);
						
						
						var xAxis = d3.svg.axis()
						    .scale(x)
						    .orient("bottom").ticks(5);
						
						var yAxis = d3.svg.axis()
						    .scale(y)
						    .orient("left");
						
						var line = d3.svg.line()
						    .x(function(d) { return x(d.date); })
						    .y(function(d) { return y(d.value); });
						
						var svg = d3.select("#testGraph").append("svg")
						    .attr("width", width + margin.left + margin.right)
						    .attr("height", height + margin.top + margin.bottom)
						  .append("g")
						    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
						
						
						//csv = $("#testGraph").data().graphContent.split("'").join("").split(", ").join("\n").replace('[', '').replace(']','').split("\\n").join("");
						data = $("#testGraph").data().graphContent.split("'").join('"')
console.log(data)
						json_data = JSON.parse(data)
//console.log(json_data)
						$.each(json_data, function(key, value) {
							
						//parse csv
			  			//var lines=csv.split("\n");
			  			var result = [];
			  			var headers= ['time','value'];
						var max = 0;
			  			for(var i=1;i<value.length;i++){
			
				  			var obj = {};
				  			var currentline=value[i];
			
				  			for(var j=0;j<headers.length;j++){
					  			obj[headers[j]] = currentline[j];
				  			}
				  			result.push(obj);
			  			}
						var i = 0
						result.forEach(function(d) {
						  d.date = new Date(d.time)
							if(d.value > max) {max = d.value;}
							if(d.date.getFullYear() > 2016) { console.log(d); console.log(i); }
i = i + 1
//console.log(d.date.getFullYear())
						}
						);
						
						x.domain(d3.extent(result, function(d) { return d.date; }));
						y.domain([0, max * 2]);
						
						svg.append("path")
						    .datum(result)
						    .attr("class", "line")
						    .attr("d", line);
						});

						svg.append("g")
						    .attr("class", "x axis")
						    .attr("transform", "translate(0," + height + ")")
						    .call(xAxis);
						
						svg.append("g")
						    .attr("class", "y axis")
						    .call(yAxis)
						  .append("text")
						    .attr("transform", "rotate(-90)")
						    .attr("y", 6)
						    .attr("dy", ".71em")
						    .style("text-anchor", "end")
						    .text("Value (&)");	
					}
					
					function repainttestGraph(){
						var divObj = $("#testGraph").parent()[0];
						var className = divObj.className;
						if(className.indexOf("large") > -1){
							className = className.replace("large", "big");
						}else{
							className = className.replace("big", "large");
						}
						divObj.className = className;
						$("#testGraph")[0].innerHTML ='';
						painttestGraph();
					}
					
					painttestGraph();
			</script>
		</div>
	</div>
</div>
{% endblock %}
